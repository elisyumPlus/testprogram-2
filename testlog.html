<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Firebase Auth + Firestore Demo</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;max-width:680px;margin:40px auto;padding:0 16px}
    form{display:grid;gap:8px;margin:16px 0}
    input,button{padding:10px;font-size:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .card{border:1px solid #ddd;border-radius:10px;padding:16px;margin:12px 0}
    code{background:#f6f8fa;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <h1>Firebase: Kayıt & Giriş & Profil</h1>

  <div class="card">
    <h2>1) Kayıt Ol</h2>
    <form id="signupForm">
      <div class="row">
        <input type="email" id="suEmail" placeholder="E-posta" required />
        <input type="password" id="suPassword" placeholder="Şifre (min 6)" required />
      </div>
      <input type="text" id="suDisplayName" placeholder="Görünen ad (opsiyonel)" />
      <button type="submit">Kayıt Ol</button>
    </form>
  </div>

  <div class="card">
    <h2>2) Giriş Yap</h2>
    <form id="signinForm">
      <div class="row">
        <input type="email" id="siEmail" placeholder="E-posta" required />
        <input type="password" id="siPassword" placeholder="Şifre" required />
      </div>
      <button type="submit">Giriş Yap</button>
      <button type="button" id="sendReset">Şifre Sıfırlama Maili Gönder</button>
    </form>
  </div>

  <div class="card">
    <h2>3) Çıkış</h2>
    <button id="signOutBtn">Çıkış Yap</button>
  </div>

  <div class="card">
    <h2>4) Profil Bilgileri (Firestore: <code>/users/{uid}</code>)</h2>
    <form id="profileForm">
      <input type="text" id="pfFullName" placeholder="Ad Soyad" />
      <input type="text" id="pfBio" placeholder="Kısa bio" />
      <button type="submit">Profilimi Kaydet/Güncelle</button>
      <button type="button" id="loadProfile">Profilimi Yükle</button>
    </form>
  </div>

  <div class="card">
    <h2>Oturum Durumu</h2>
    <pre id="status">...</pre>
  </div>

  <script type="module">
    // 1) Konsoldan aldığın config ile DEĞİŞTİR
    const firebaseConfig = {
  apiKey: "AIzaSyBlaglZNm3X2jQRrOPNA9Q6D3nCvjG5VjU",
  authDomain: "nrussystem.firebaseapp.com",
  projectId: "nrussystem",
  appId: "1:907157259049:web:7a4f4b547803345ce92d38",
};

    // 2) Modüler SDK importları (v9+)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import {
      getAuth, onAuthStateChanged,
      createUserWithEmailAndPassword, signInWithEmailAndPassword,
      signOut, updateProfile, sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import {
      getFirestore, doc, setDoc, getDoc
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    // 3) Başlat
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const $ = (s) => document.querySelector(s);
    const statusEl = $("#status");

    // 4) Oturum değişimlerini izle (UI'ya yaz)
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const token = await user.getIdTokenResult();
        statusEl.textContent =
          `Giriş yapıldı:
uid: ${user.uid}
email: ${user.email}
emailVerified: ${user.emailVerified}
claims: ${JSON.stringify(token.claims)}`;
      } else {
        statusEl.textContent = "Giriş yapılmadı.";
      }
    });

    // 5) Kayıt ol
    $("#signupForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = $("#suEmail").value.trim();
      const password = $("#suPassword").value;
      const displayName = $("#suDisplayName").value.trim();

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        if (displayName) {
          await updateProfile(cred.user, { displayName });
        }
        // İlk kullanıcı dokümanı
        await setDoc(doc(db, "users", cred.user.uid), {
          email,
          displayName: displayName || null,
          createdAt: new Date().toISOString()
        }, { merge: true });

        alert("Kayıt başarılı! Giriş yapıldı.");
      } catch (err) {
        alert("Kayıt hatası: " + err.message);
      }
    });

    // 6) Giriş yap
    $("#signinForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = $("#siEmail").value.trim();
      const password = $("#siPassword").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        alert("Giriş başarılı!");
      } catch (err) {
        alert("Giriş hatası: " + err.message);
      }
    });

    // 7) Şifre sıfırlama
    $("#sendReset").addEventListener("click", async () => {
      const email = $("#siEmail").value.trim();
      if (!email) return alert("Lütfen e-posta gir.");
      try {
        await sendPasswordResetEmail(auth, email);
        alert("Sıfırlama maili gönderildi.");
      } catch (err) {
        alert("Sıfırlama hatası: " + err.message);
      }
    });

    // 8) Çıkış
    $("#signOutBtn").addEventListener("click", async () => {
      await signOut(auth);
      alert("Çıkış yapıldı.");
    });

    // 9) Profil kaydet/güncelle
    $("#profileForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) return alert("Önce giriş yap.");
      const fullName = $("#pfFullName").value.trim() || null;
      const bio = $("#pfBio").value.trim() || null;

      try {
        await setDoc(doc(db, "users", user.uid), {
          fullName, bio, updatedAt: new Date().toISOString()
        }, { merge: true });
        alert("Profil kaydedildi.");
      } catch (err) {
        alert("Profil hatası: " + err.message);
      }
    });

    // 10) Profil yükle
    $("#loadProfile").addEventListener("click", async () => {
      const user = auth.currentUser;
      if (!user) return alert("Önce giriş yap.");
      try {
        const snap = await getDoc(doc(db, "users", user.uid));
        if (snap.exists()) {
          const data = snap.data();
          $("#pfFullName").value = data.fullName || "";
          $("#pfBio").value = data.bio || "";
          alert("Profil yüklendi.");
        } else {
          alert("Profil yok (önce kaydedin).");
        }
      } catch (err) {
        alert("Yükleme hatası: " + err.message);
      }
    });
  </script>
</body>
</html>
