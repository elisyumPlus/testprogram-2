<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>a   Aauth + Firestore Demo</title>
  <style>
    :root{color-scheme:light dark}
    body{font-family:system-ui,Arial,sans-serif;max-width:720px;margin:40px auto;padding:0 16px}
    h1{margin-bottom:8px}
    .card{border:1px solid #ddd;border-radius:12px;padding:16px;margin:14px 0}
    form{display:grid;gap:10px;margin-top:8px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    input,button{padding:10px;font-size:16px;border-radius:10px;border:1px solid #ccc}
    button{cursor:pointer}
    pre{white-space:pre-wrap}
    code{background:#f6f8fa;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <h1>Firebase: Kayıt • Giriş • Profil</h1>
  <p>Profil verileri Firestore’da <code>/users/{uid}</code> dokümanında tutulur.</p>

  <!-- Kayıt -->
  <div class="card">
    <h2>1) Kayıt Ol</h2>
    <form id="signupForm">
      <div class="row">
        <input type="email" id="suEmail" placeholder="E-posta" required />
        <input type="password" id="suPassword" placeholder="Şifre (min 6)" required />
      </div>
      <input type="text" id="suDisplayName" placeholder="Görünen ad (opsiyonel)" />
      <button type="submit">Kayıt Ol</button>
    </form>
  </div>

  <!-- Giriş -->
  <div class="card">
    <h2>2) Giriş Yap</h2>
    <form id="signinForm">
      <div class="row">
        <input type="email" id="siEmail" placeholder="E-posta" required />
        <input type="password" id="siPassword" placeholder="Şifre" required />
      </div>
      <div class="row">
        <button type="submit">Giriş Yap</button>
        <button type="button" id="sendReset">Şifre Sıfırlama Maili</button>
      </div>
    </form>
  </div>

  <!-- Çıkış -->
  <div class="card">
    <h2>3) Çıkış</h2>
    <button id="signOutBtn">Çıkış Yap</button>
  </div>

  <!-- Profil -->
  <div class="card">
    <h2>4) Profil (Firestore: <code>/users/{uid}</code>)</h2>
    <form id="profileForm">
      <input type="text" id="pfFullName" placeholder="Ad Soyad" />
      <input type="text" id="pfBio" placeholder="Kısa bio" />
      <div class="row">
        <button type="submit">Kaydet/Güncelle</button>
        <button type="button" id="loadProfile">Profilimi Yükle</button>
      </div>
    </form>
  </div>

  <!-- Durum -->
  <div class="card">
    <h2>Oturum Durumu</h2>
    <pre id="status">Yükleniyor…</pre>
  </div>

  <!-- Firebase SDK: CDN (v10) -->
  <script type="module">
   const firebaseConfig = {
  apiKey: "AIzaSyBlaglZNm3X2jQRrOPNA9Q6D3nCvjG5VjU",
  authDomain: "nrussystem.firebaseapp.com",
  projectId: "nrussystem",
  storageBucket: "nrussystem.appspot.com",
  messagingSenderId: "907157259049",
  appId: "1:907157259049:web:7a4f4b547803345ce92d38",
  measurementId: "G-95XV7GLF6P"
};


    // Modüler SDK importları
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import {
      getAuth, onAuthStateChanged,
      createUserWithEmailAndPassword, signInWithEmailAndPassword,
      signOut, updateProfile, sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import {
      getFirestore, doc, setDoc, getDoc
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    // Başlat
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const $ = (s) => document.querySelector(s);
    const statusEl = $("#status");

    // Oturum dinleme
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const token = await user.getIdTokenResult();
        statusEl.textContent =
`Giriş yapıldı:
uid: ${user.uid}
email: ${user.email}
emailVerified: ${user.emailVerified}
claims: ${JSON.stringify(token.claims)}`;
      } else {
        statusEl.textContent = "Giriş yapılmadı.";
      }
    });

    // Kayıt
    $("#signupForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = $("#suEmail").value.trim();
      const password = $("#suPassword").value;
      const displayName = $("#suDisplayName").value.trim() || null;

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        if (displayName) await updateProfile(cred.user, { displayName });
        await setDoc(doc(db, "users", cred.user.uid), {
          email,
          displayName,
          createdAt: new Date().toISOString()
        }, { merge: true });
        alert("Kayıt başarılı! Giriş yapıldı.");
      } catch (err) {
        alert("Kayıt hatası: " + err.message);
      }
    });

    // Giriş
    $("#signinForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = $("#siEmail").value.trim();
      const password = $("#siPassword").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        alert("Giriş başarılı!");
      } catch (err) {
        alert("Giriş hatası: " + err.message);
      }
    });

    // Şifre sıfırlama
    $("#sendReset").addEventListener("click", async () => {
      const email = $("#siEmail").value.trim();
      if (!email) return alert("Lütfen e-posta gir.");
      try {
        await sendPasswordResetEmail(auth, email);
        alert("Sıfırlama maili gönderildi.");
      } catch (err) {
        alert("Sıfırlama hatası: " + err.message);
      }
    });

    // Çıkış
    $("#signOutBtn").addEventListener("click", async () => {
      await signOut(auth);
      alert("Çıkış yapıldı.");
    });

    // Profil kaydet/güncelle
    $("#profileForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) return alert("Önce giriş yap.");
      const fullName = $("#pfFullName").value.trim() || null;
      const bio = $("#pfBio").value.trim() || null;

      try {
        await setDoc(doc(db, "users", user.uid), {
          fullName, bio, updatedAt: new Date().toISOString()
        }, { merge: true });
        alert("Profil kaydedildi.");
      } catch (err) {
        alert("Profil hatası: " + err.message);
      }
    });

    // Profil yükle
    $("#loadProfile").addEventListener("click", async () => {
      const user = auth.currentUser;
      if (!user) return alert("Önce giriş yap.");
      try {
        const snap = await getDoc(doc(db, "users", user.uid));
        if (snap.exists()) {
          const data = snap.data();
          $("#pfFullName").value = data.fullName || "";
          $("#pfBio").value = data.bio || "";
          alert("Profil yüklendi.");
        } else {
          alert("Profil bulunamadı, önce kaydedin.");
        }
      } catch (err) {
        alert("Yükleme hatası: " + err.message);
      }
    });
  </script>
</body>
</html>
