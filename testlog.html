<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Firebase Auth + Firestore Demo</title>
  <style>
    :root{color-scheme:light dark}
    body{font-family:system-ui,Arial,sans-serif;max-width:720px;margin:40px auto;padding:0 16px}
    h1{margin-bottom:8px}
    .card{border:1px solid #ddd;border-radius:12px;padding:16px;margin:14px 0}
    form{display:grid;gap:10px;margin-top:8px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    input,button{padding:10px;font-size:16px;border-radius:10px;border:1px solid #ccc}
    button{cursor:pointer}
    pre{white-space:pre-wrap}
    code{background:#f6f8fa;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <h1>Firebase: KayÄ±t â€¢ GiriÅŸ â€¢ Profil</h1>
  <p>Profil verileri Firestoreâ€™da <code>/users/{uid}</code> dokÃ¼manÄ±nda tutulur.</p>

  <!-- KayÄ±t -->
  <div class="card">
    <h2>1) KayÄ±t Ol</h2>
    <form id="signupForm">
      <div class="row">
        <input type="email" id="suEmail" placeholder="E-posta" required />
        <input type="password" id="suPassword" placeholder="Åžifre (min 6)" required />
      </div>
      <input type="text" id="suDisplayName" placeholder="GÃ¶rÃ¼nen ad (opsiyonel)" />
      <button type="submit">KayÄ±t Ol</button>
    </form>
  </div>

  <!-- GiriÅŸ -->
  <div class="card">
    <h2>2) GiriÅŸ Yap</h2>
    <form id="signinForm">
      <div class="row">
        <input type="email" id="siEmail" placeholder="E-posta" required />
        <input type="password" id="siPassword" placeholder="Åžifre" required />
      </div>
      <div class="row">
        <button type="submit">GiriÅŸ Yap</button>
        <button type="button" id="sendReset">Åžifre SÄ±fÄ±rlama Maili</button>
      </div>
    </form>
  </div>

  <!-- Ã‡Ä±kÄ±ÅŸ -->
  <div class="card">
    <h2>3) Ã‡Ä±kÄ±ÅŸ</h2>
    <button id="signOutBtn">Ã‡Ä±kÄ±ÅŸ Yap</button>
  </div>

  <!-- Profil -->
  <div class="card">
    <h2>4) Profil (Firestore: <code>/users/{uid}</code>)</h2>
    <form id="profileForm">
      <input type="text" id="pfFullName" placeholder="Ad Soyad" />
      <input type="text" id="pfBio" placeholder="KÄ±sa bio" />
      <div class="row">
        <button type="submit">Kaydet/GÃ¼ncelle</button>
        <button type="button" id="loadProfile">Profilimi YÃ¼kle</button>
      </div>
    </form>
  </div>

  <!-- Durum -->
  <div class="card">
    <h2>Oturum Durumu</h2>
    <pre id="status">YÃ¼kleniyorâ€¦</pre>
  </div>

  <!-- Firebase SDK: CDN (v10) -->
  <script type="module">
    // ðŸ”´ BURAYI KENDÄ° PROJE AYARLARINLA DOLDUR
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID",
      // measurementId opsiyonel
    };

    // ModÃ¼ler SDK importlarÄ±
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import {
      getAuth, onAuthStateChanged,
      createUserWithEmailAndPassword, signInWithEmailAndPassword,
      signOut, updateProfile, sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import {
      getFirestore, doc, setDoc, getDoc
    } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

    // BaÅŸlat
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const $ = (s) => document.querySelector(s);
    const statusEl = $("#status");

    // Oturum dinleme
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const token = await user.getIdTokenResult();
        statusEl.textContent =
`GiriÅŸ yapÄ±ldÄ±:
uid: ${user.uid}
email: ${user.email}
emailVerified: ${user.emailVerified}
claims: ${JSON.stringify(token.claims)}`;
      } else {
        statusEl.textContent = "GiriÅŸ yapÄ±lmadÄ±.";
      }
    });

    // KayÄ±t
    $("#signupForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = $("#suEmail").value.trim();
      const password = $("#suPassword").value;
      const displayName = $("#suDisplayName").value.trim() || null;

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        if (displayName) await updateProfile(cred.user, { displayName });
        await setDoc(doc(db, "users", cred.user.uid), {
          email,
          displayName,
          createdAt: new Date().toISOString()
        }, { merge: true });
        alert("KayÄ±t baÅŸarÄ±lÄ±! GiriÅŸ yapÄ±ldÄ±.");
      } catch (err) {
        alert("KayÄ±t hatasÄ±: " + err.message);
      }
    });

    // GiriÅŸ
    $("#signinForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = $("#siEmail").value.trim();
      const password = $("#siPassword").value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
        alert("GiriÅŸ baÅŸarÄ±lÄ±!");
      } catch (err) {
        alert("GiriÅŸ hatasÄ±: " + err.message);
      }
    });

    // Åžifre sÄ±fÄ±rlama
    $("#sendReset").addEventListener("click", async () => {
      const email = $("#siEmail").value.trim();
      if (!email) return alert("LÃ¼tfen e-posta gir.");
      try {
        await sendPasswordResetEmail(auth, email);
        alert("SÄ±fÄ±rlama maili gÃ¶nderildi.");
      } catch (err) {
        alert("SÄ±fÄ±rlama hatasÄ±: " + err.message);
      }
    });

    // Ã‡Ä±kÄ±ÅŸ
    $("#signOutBtn").addEventListener("click", async () => {
      await signOut(auth);
      alert("Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±.");
    });

    // Profil kaydet/gÃ¼ncelle
    $("#profileForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) return alert("Ã–nce giriÅŸ yap.");
      const fullName = $("#pfFullName").value.trim() || null;
      const bio = $("#pfBio").value.trim() || null;

      try {
        await setDoc(doc(db, "users", user.uid), {
          fullName, bio, updatedAt: new Date().toISOString()
        }, { merge: true });
        alert("Profil kaydedildi.");
      } catch (err) {
        alert("Profil hatasÄ±: " + err.message);
      }
    });

    // Profil yÃ¼kle
    $("#loadProfile").addEventListener("click", async () => {
      const user = auth.currentUser;
      if (!user) return alert("Ã–nce giriÅŸ yap.");
      try {
        const snap = await getDoc(doc(db, "users", user.uid));
        if (snap.exists()) {
          const data = snap.data();
          $("#pfFullName").value = data.fullName || "";
          $("#pfBio").value = data.bio || "";
          alert("Profil yÃ¼klendi.");
        } else {
          alert("Profil bulunamadÄ±, Ã¶nce kaydedin.");
        }
      } catch (err) {
        alert("YÃ¼kleme hatasÄ±: " + err.message);
      }
    });
  </script>
</body>
</html>
